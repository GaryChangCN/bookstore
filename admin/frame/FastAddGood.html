<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/jquery.min.js"></script>
		<script src="../js/UploadPreview.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/fileupload.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<style type="text/css">
		* {
			margin: 0px;
			padding: 0px;
			border: 0px;
		}
		
		@media only screen and (max-width: 640px) {
			.content {
				width: 100%;
			}
			.container {
				width: 100%;
				text-align: center;
			}
		}
		
		@media only screen and (min-width: 640px) {
			.container {
				width: 100%;
				padding-top: 50px;
			}
			.content {
				width: 640px;
				margin-left: auto;
				margin-right: auto;
			}
		}
		
		@media only screen and (max-width: 249px) {
			* {
				display: none;
			}
		}
		
		.content {
			background-color: gainsboro;
		}
		
		#isbn {
			height: 40px;
			margin-top: 15px;
			opacity: 0.6;
			text-align: center;
			border-radius: 5px;
			width: 70%;
		}
		
		.ok {
			height: 40px;
			width: 40px;
			float: right;
			background-color: white;
			opacity: 0.6;
			color: rgb(103, 166, 197);
			margin: 15px 25px 0px 0px;
			line-height: 40px;
			border-radius: 50%;
		}
		
		tr {
			width: 100%;
			height: 48px;
		}
		
		tr td:first-child {
			width: 20%;
			text-align: center;
			opacity: 0.5;
			padding-left: 4%;
		}
		
		tr td:last-child {
			width: 80%;
			text-align: left;
			padding-left: 11%;
		}
		
		tr td input,
		tr td select {
			height: 40px;
			opacity: 0.6;
			padding-left: 15px;
			border-radius: 5px;
			width: 80%;
		}
		
		.submit {
			position: fixed;
			bottom: 30px;
			right: 2%;
			height: 60px;
			width: 60px;
			float: right;
			font-size: 1em;
			background-color: rgb(84, 186, 236);
			color: white;
			line-height: 40px;
			border-radius: 50%;
			z-index: 55;
			box-shadow: 0px 2px 1px 1px #BBBBBB;
		}
	</style>
	<script type="text/javascript">
		$(document).ready(function() {
			var information = new Object();
			var informationPic = "";
			$(".ok").click(function() {
				var isbn = $("#isbn").val();
				var reg = /^[0-9]{13}$/;
				if (reg.test(isbn)) {
					$.ajax({
						type: "get",
						url: "https://api.douban.com/v2/book/isbn/:" + isbn,
						async: false,
						dataType: "jsonp",
						success: function(data) {
							$("#title").val(data.title);
							$("#publisher").val(data.publisher);
							$("#author").val(data.author);
							$("#isbn13").val(data.isbn13);
							var reg = /[a-zA-Z]/g;
							var b = data.price.replace(reg, "");
							information.price=parseInt(b);
							$("#price").val(information.price).attr('readonly', 'readonly');
							$(".img").attr('src', data.images.large).css('opacity', 1);
							informationPic = "0"; //pic默认属性为0
							information.picsrc = data.images.large;
						},
						error: function() {
							alert("找不到此isbn对应图书");
						}
					});
				} else {
					alert("请输入13位数字ISBN码")
				}
			})
			$(".img").click(function() {
				informationPic = "1";
				$(this).parent().parent().next().slideDown();
				$('body,html').animate({
					scrollTop: 925
				}, 1000);
			})
			$(".submit").click(function() {
				information.title = $("#title").val();
				information.publisher = $("#publisher").val();
				information.author = $("#author").val();
				information.isbn = $("#isbn13").val();
				information.price = $("#price").val();
				information.newprice = $("#newprice").val();
				information.oldprice = $("#oldprice").val();
				information.newdiscount = $("#newdiscount").val();
				information.olddiscount = $("#olddiscount").val();
				information.newstock = $("#newstock").val();
				information.oldstock = $("#oldstock").val()
				if (information.newprice == "" || information.newprice == null) {
					information.newprice = information.price;
				}
				if (information.oldprice == "" || information.oldprice == null) {
					var xinshu = information.newprice;
					information.oldprice = Math.ceil((parseInt(xinshu) / 2) - 1);
				}
				if (information.newdiscount == "" || information.newdiscount == null) {
					information.newdiscount = 0;
				}
				if (information.olddiscount == "" || information.olddiscount == null) {
					information.olddiscount = 0;
				}
				if (information.newstock == "" || information.newstock == null) {
					information.newstock = 999;
				}
				if (information.oldstock == "" || information.oldstock == null) {
					information.oldstock = 999;
				}
				//				for (var prop in information) {
				//					console.log(prop + " : " + information[prop]);
				//					alert(prop + " : " + information[prop])
				//				}
				if (information.title != "" && information.price != "") {
					if (informationPic == "0") {
						$.ajax({
							type: "post",
							url: "../FastAddGood.php",
							async: false,
							data: {
								"type": "0",
								"title": information.title,
								"publisher": information.publisher,
								"author": information.author,
								"isbn": information.isbn,
								"newprice": information.newprice,
								"oldprice": information.oldprice,
								"newdiscount": information.newdiscount,
								"olddiscount": information.olddiscount,
								"newstock": information.newstock,
								"oldstock": information.oldstock,
								"picsrc": information.picsrc
							},
							success: function(data) {
								document.write(data);
							}
						});
					} else {
						$.ajaxFileUpload({
							url: '../FastAddGood.php', //用于文件上传的服务器端请求地址
							secureuri: false, //是否需要安全协议，一般设置为false
							fileElementId: 'file', //文件上传域的ID
							dataType: 'text', //返回值类型 一般设置为json
							data: {
								"type": "1",
								"title": information.title,
								"publisher": information.publisher,
								"author": information.author,
								"isbn": information.isbn,
								"newprice": information.newprice,
								"oldprice": information.oldprice,
								"newdiscount": information.newdiscount,
								"olddiscount": information.olddiscount,
								"newstock": information.newstock,
								"oldstock": information.picsrc
							},
							success: function(data) //服务器成功响应处理函数
								{
									document.write(data)
								}
						})
					}
				} else {
					alert("书名、isbn、定价为必填项！");
				}
			})
		})
	</script>

	<body>
		<div class="container">
			<div class="content">
				<div class="hearder" style="width: 100%;background-color: #05A2EF;height: 70px;text-align: center;box-shadow: 0px 1px 1px 1px #BBBBBB;z-index: 45;">
					<input type="number" id="isbn" placeholder="这里输入ISBN码" />
					<button class="ok">ok</button>
				</div>
				<button class="submit">上架</button>
				<table style="padding-top: 15px;width: 100%;">
					<tr>
						<!--tittle-->
						<td>书名</td>
						<td>
							<input type="text" id="title" />
						</td>
					</tr>
					<tr>
						<!--publisher-->
						<td>出版社</td>
						<td>
							<input type="text" id="publisher" />
						</td>
					</tr>
					<tr>
						<!--author-->
						<td>作者</td>
						<td>
							<input type="text" id="author" />
						</td>
					</tr>
					<tr>
						<!--isbn-->
						<td>ISBN13</td>
						<td>
							<input type="number" id="isbn13" />
						</td>
					</tr>
					<tr>
						<!--（定价）-->
						<td>定价</td>
						<td>
							<input type="number" id="price" />
						</td>
					</tr>
					<tr>
						<!--新书价格-->
						<td>新书价格</td>
						<td>
							<input type="number" placeholder="默认为定价" id="newprice" />
						</td>
					</tr>
					<tr>
						<!--旧书价格-->
						<td>旧书价格</td>
						<td>
							<input type="number" placeholder="默认为新书价一半减一元" id="oldprice" />
						</td>
					</tr>
					<tr>
						<!--新书折扣-->
						<td>新书折扣</td>
						<td>
							<input type="number" placeholder="0~9 默认为0不打折" id="newdiscount" />
						</td>
					</tr>
					<tr>
						<!--旧书折扣-->
						<td>旧书折扣</td>
						<td>
							<input type="number" placeholder="0~9 默认为0不打折" id="olddiscount" />
						</td>
					</tr>
					<tr>
						<td>新书库存</td>
						<td>
							<input type="number" placeholder="默认为999且不显示" id="newstock" />
						</td>
					</tr>
					<tr>
						<td>旧书库存</td>
						<td>
							<input type="number" placeholder="默认为999且不显示" id="oldstock" />
						</td>
					</tr>
					<tr>
						<td>图片 </br>点击图片修改</td>
						<td><img class="img" id="imghead" style="opacity: 0.4;width: 150px;height: 200px;" src="../../img/icon/pic.gif" />

						</td>
					</tr>
					<tr style="display: none;">
						<td>

						</td>
						<td>
							<div id="preview">
								<!--<img id="imghead" width=100 height=100 border=0 src='<%=request.getContextPath()%>/images/defaul.jpg'>-->
							</div>
							<input type="file" id="file" name="file" onchange="previewImage(this)" />
						</td>
					</tr>
				</table>
			</div>
		</div>
	</body>
	<script type="text/javascript">
	</script>

</html>